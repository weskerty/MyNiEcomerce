<div style="text-align:center;">

<div class="section">
    <h1>Candidatos</h1>
    <div class="gallery-container">
        <div id="actual-gallery" 
             class="contenedor-imagenes-animado"
             data-json-path="web/Dinamico/data.json">
        </div>
    </div>
</div>

<h1>Lista Total</h1>
<div class="grid-gallery" 
     id="Corrupcion-grid"
     data-json-path="web/Dinamico/data.json"
     data-path-filter="dulces">
</div>

<a href="web/es.html" class="back-button">← Volver al Inicio</a>
</div>

<script>
async function loadGalleryData(j) {
    try {
        const r = await fetch(j);
        const d = await r.json();
        return d.galleries;
    } catch (e) {
        console.error(`Error loading gallery data from ${j}:`, e);
        return null;
    }
}

function createGridGallery(c, i) {
    c.innerHTML = i.map(x => `
        <a href="${x.link || '#'}">
            <img src="${x.image}" alt="${x.name || 'Imagen'}" loading="lazy" />
        </a>
    `).join('');
}

function filterGalleryData(g, c) {
    const k = c.dataset.galleryKey;
    const f = c.dataset.galleryFilter;
    const p = c.dataset.pathFilter;
    const id = c.id.replace('-grid', '');
    
    if (k && g[k]) {
        let im = g[k].images || [];
        if (p) {
            im = im.filter(x => x.path && x.path.includes(p));
        }
        return im;
    }
    
    if (f) {
        const m = Object.entries(g).filter(([ky, v]) => 
            ky.toLowerCase().includes(f.toLowerCase())
        );
        
        if (m.length > 0) {
            let im = m.flatMap(([ky, v]) => v.images || []);
            if (p) {
                im = im.filter(x => x.path && x.path.includes(p));
            }
            return im;
        }
    }
    
    const mk = Object.keys(g).find(ky => 
        ky.toLowerCase() === id.toLowerCase()
    );
    
    if (mk && g[mk]) {
        let im = g[mk].images || [];
        if (p) {
            im = im.filter(x => x.path && x.path.includes(p));
        }
        return im;
    }
    
    return [];
}

async function initializeUniversalGallery() {
    const ge = document.querySelectorAll('.grid-gallery[data-json-path]');
    
    for (const c of ge) {
        const j = c.dataset.jsonPath;
        
        if (!j) {
            c.innerHTML = '<p>No se especificó ruta JSON</p>';
            continue;
        }
        
        const gd = await loadGalleryData(j);
        
        if (!gd) {
            c.innerHTML = '<p>Sin Corrupcion</p>';
            continue;
        }
        
        const im = filterGalleryData(gd, c);
        
        if (im.length > 0) {
            createGridGallery(c, im);
        } else {
            c.innerHTML = '<p>Sin Corrupcion</p>';
        }
    }
}

initializeUniversalGallery();
</script>
